# PHP 编程规范（初稿）
> 维护人员: Tony Wang、Xie_Jinlong		
> 创建时间: 2016-12-06 	
> 最后修改时间：2017-05-11

---
> 不管有多少人共同参与同一项目，一定要确保每一行代码都像是同一个人编写的。

## 代码基本规范
## 类规范
1. 方法名(method name) 必须使用驼峰式(cameCase)写法。
2. 所有的属性(property)和方法(method) 必须有可见性声明；抽象(abstract)和终结(final)声明必须在可见性声明之前；而静态(static)声明必须在可见性声明之后。
3. 类(class)的左花括号必须放到其声明下面自成一行，右花括号则必须放到类主体下面自成一行。
4. 方法(method)的左花括号必须放到其声明下面自成一行，右花括号则必须放到方法主体的下一行。
5. 不可使用用 var 关键字来声明一个属性(property)
6. 在方法参数列表中，逗号之前不可有空格，而逗号之后则必须要有一个空格。
7. 不同方法之间，必须有一空格区分。

### 代码示例：
```php
<?php
namespace Vendor\Package;

use FooInterface;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class Foo extends Bar implements FooInterface
{
	const SOOLIFE_DEMO = 'Better life from now';

	public $foo = null;
	private $soo = [];

    public function sampleFunction($a, $b = null)
    {
		// method body
    }

    final public static function Bar()
    {
		// method body
    }

	public function fooBarBaz($arg1, &$arg2, $arg3 = [])
    {
		// method body
    }
}
```

## 函数规范
1. 函数声明左花括号不必换行，右花括号则必须放到类主体下面自成一行。
2. 函数参数之间应该有一空格，位于两参数间分割逗号之后。
3. 函数声明左花括号前应有一空格。
4. 函数名建议使用小写字母加下划线组成，并能表现函数功能。
### 示例代码

```php
	<?php
		// 函数声明写法
		function in_array_case($arr = [], $str) {
			// function body
		}


		// 匿名函数写法如下
		$closureWithArgs = function($arg1, $arg2) {
			// body
		};

		// 匿名函数与闭包
		$closureWithArgsAndVars = function($arg1, $arg2) use ($var1, $var2) {
			// body
		};
	?>
```

## 控制结构
1. 控制结构的左花括号必须跟其放在同一行，右花括号必须放在该控制结构代码主体的下一行。
2. 控制结构的左括号之后不可有空格，右括号之前也不可有空格。
3. 控制结构左括号之前与右括号之后应有一个空格。
### 示例代码：
```php
<?php
	// if/else 语句规范如下
	if ($a === $b) {
		bar();
	} elseif ($a > $b) {
		$foo->bar($arg1);
	} else {
		BazClass::bar($arg2, $arg3);
	}

	// 标准的 switch 结构如下代码所示，留意括号、空格以及花括号的位置。 case 语句必须相对 switch 进行一次缩进，而 break 语句以及 case 内的其它语句都 必须 相对 case 进行一次缩进
	switch ($expr) {
		case 0:
			echo 'First case, with a break';
			break;
		case 1:
			echo 'Second case, which falls through';
			// no break
		case 2:
		case 3:
		case 4:
			echo 'Third case, return instead of break';
			return;
		default:
			echo 'Default case';
			break;
	}

	// 标准的 for 语句如下所示，注意其 括号、空格以及花括号的位置。
	for ($i = 0; $i < 10; $i++) {
		// for body
	}

	// 标准的 foreach 语句如下所示，注意其 括号、空格以及花括号的位置。
	foreach ($iterable as $key => $value) {
		// foreach body
	}
?>
```

## 关键字
1. PHP关键字(keywords)必须使用小写字母。如：if、else、while、for、foreach、true、false、null等等。
### 示例代码
```php
<?php
	$param = $tihs->request->getJsonRawBody(true);
	if (true) {
		$data = null;
		# code...
	}
?>
```

## 数据库操作规范

1. 所有外部提交数据组成SQL时，必须通过传参方式执行SQL，或必须检测所有数据合法性。sql中字段值需加单引号。
2. 尽量避免复杂SQL，如复杂join操作或in操作。
3. 减少读写次数，尽量避免循环 写入、读取、更新、删除操作。
4. 读取数据时，只取有用字段，尽量避免使用 SELECT * 操作。
5. 写入操作时，必须写字段名，即 不允许使用如下语句：INSERT INTO table values(...)。
6. 尽量简单应用mysql，尽量不要让mysql去做运算。比如 md5 或 order by Rand()。
7. 查询语句多使用 explain 分析语句效率，索引使用情况等。
8. 如果列类型是字符串，那一定要在条件中将数据使用引号引用起来,否则不使用索引。
9. 尽可能降低事务复杂度，事务开启必须要有结束，提交或回滚。
10.


## 异常处理
### 示例代码：
```php
<?php
	// 标准的 try catch 语句如下所示，注意其 括号、空格以及花括号的位置。
	try {
		// try body
	} catch (\Phalcon\Exception $e) {
		// catch body
	} catch (Exception $e) {
		// catch body
	}
?>
```

## 注释的规则
1.  **源代码开头注释**  
  在每一个源代码的开头部分，要包含文件的编号、简要说明、作者和最后修改日期。具体例子如下所示:
  ```php
  // +----------------------------------------------------------------------
  // | 系统启动引导程序
  // +----------------------------------------------------------------------
  // | Copyright (c) 2017年 如此生活. All rights reserved.
  // +----------------------------------------------------------------------
  // | File:   bootstrap.php
  // |
  // | Author: Tony Wang <tony@iapp.hk>
  // | Created:   2016-04-21
  // +----------------------------------------------------------------------
  ```

2.  **函数、方法开头注释**  
  建议在函数的开头的注释如下所示:
  ```php
  /**
  * 发送数据到支付接口
  * @author tony wang 2016-12-12
  *
  * @access public
  * @param $orders_id int 订单编号
  * @param $amount decimal  金额
  * @param $reason string  原因
  * @param $remark string  备注
  * @return bool 返回
  */
  ```
  该函数注释主要是对函数传入的形参和回传值进行说明，并简要说明该函数的作用。

3. **函数体内部注释**  
  函数体内内的注释统一采用重新起行，以//开头， 例如：
```php
// 确定数组中参数的值是否为空
if (empty($params['equation'])) {
	show_message(“xxxxxxx”);
		return;
}
```

# 原生APP与H5交互规范
> 维护人员: 刘存阳   
> 创建时间: 2016-12-22  

## 一、概述
实现Web和App活动页的交互，需要加载sdk.2.0.js文件，必要时还需加载自定义的js文件。sdk.2.0.js文件主要提供App的接口函数和调用的方法，一共提供两种调用模式：Data属性模式和Js模式。
- Data属性模式：加载sdk.2.0.js文件，在需要跳转的Dom元素上加上相应的class类名和data属性，实现相应接口的跳转。部分接口需要动态传入参数，则需要加载自定义的js，下面的实例调用中会详细介绍。
- Js模式：加载sdk.2.0.js文件和自定义js文件，在需要跳转的Dom元素上加上自定义的选择器，通过自定义的js文件传入所需的参数并调用相应的方法，实现交互。
- 在下面方法参数介绍中的[ ]中参数可传可不传，穿入时，以传入的参数为主；不传入时，则会自动以设置默认参数值。

## 二、接口调用
### 1、打开商品详情页
简述：点击被选择的页面元素，web页面跳转触屏版该商品的详情web页面，App跳转该商品详情的App原生页面。
实现方法：

1. ***Data属性模式***     
不需写 Js 代码。在需被点击的Dom的元素上添加class="open-goods-detail"激活调用商品详情页接口的函数，将该商品的商品编号携带在data-goods-id=" " 属性上。
实例：
```html
<div class="open-goods-detail" data-goods-id="12480">
  ...
</div>
```  
1. ***Js模式***  
在需被点击的Dom元素上添加选择器，以此作为调用openGoodsDetail()的Dom节点。
openGoodsDetail(selector,goodsId,[url])的参数介绍：

| 参数     | 类型     | 默认值     | 描述     |
| :------------- | :------------- | :------------- | :------------- |
| selector       | string       | 无       | 需被点击的Dom节点，可用class、id、标签等选择器。       |
| goodsId       | string/number       | 无       | 跳转相应的商品详情的商品编号。       |
| url       | string       | 'http://item.soolife.cn/m/'+goodsId+'.html'       | web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。       |

实例：
- HTML   
```html
<div id="open-goods-detail">
  ...
</div>
```
- JS 部分（没有传入url参数）：
```JavaScript
var self = new BaseSdk();
self.openGoodsDetail('#open_goods_detail','10891')
```
- JS 部分（传入url参数）：
```JavaScript
var self = new BaseSdk();
self.openGoodsDetail('#open_goods_detail','10891','http://item.soolife.cn/m/12488.html')
```

### 2、打开店铺页
简述：点击被选择的页面元素，web页面跳转该店铺的web页面，App跳转该店铺的App原生页面。
实现方法：
1. ***Data属性模式***
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-shop "激活调用店铺页接口的函数，将该店铺的店铺编号携带在data-shop-id=" " 属性上。
	实例：
```html
<div class="open-shop" data-shop-id="280">
  ...
</div>  
```

1. ***Js模式***
	在被点击的Dom元素上添加选择器，以此作为调用openShop()的Dom节点。     
openShop (selector,shopId,[url])的参数介绍：    

| 参数     | 类型     | 默认值     | 描述     |
| :------------- | :------------- | :------------- | :------------- |
| selector       | string       | 无       | 需被点击的Dom节点，可用class、id、标签等选择器。       |
| shopId       | string/number       | http://store.soolife.cn/m/{id}.html       | web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。       |

***实例：***
- HTML  
```html
<div id="open_shop">
  ...
</div>
```
- JS 部分（没有传入url参数）：
```JavaScript
var self = new BaseSdk();
self.openShop('#open_shop','208')
```
- JS 部分（传入url参数）：
```JavaScript
var self = new BaseSdk();
self.openShop('#open_shop','208','http://store.soolife.cn/m/208.html')
```

### 3、打开新web页
简述：点击被选择的页面元素，web页面跳转新的web页面，App以App的方式跳转新的web页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-new-web "激活调用跳转新页面接口的函数，将新页面的链接地址携带在data-new-web-url=" " 属性上。
	实例：

	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用openNewWeb()的Dom节点。
openNewWeb(selector,url)的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可用class、id、标签等选择器。
url
string
无
web跳转的链接地址。
实例：

### 4、打开购物车页面
简述：点击被选择的页面元素，web页面跳转触屏版的web购物车页面，App跳转购物车的App原生页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被操作的Dom的元素上添加class="open-carts"激活打开购物车接口的函数。
	实例：

	Js模式
	在被操作的Dom元素上添加选择器，以此作为调用openCarts()的Dom节点。
openCarts (selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可用class、id、标签等选择器。
url
string
'https://orders.soolife.cn/m/index.html'
web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。
实例：



### 5、打开扫一扫功能
简述：点击被选择的元素，web页面则打开如此生活App的扫一扫功能，没有安装则跳转下载App的页面，App则直接调用如此生活App扫一扫的功能。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-scan-code"激活调用扫一扫接口的函数。
	实例：

	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用openScanCode()的Dom节点。
openScanCode (selector)的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可class、id、标签等选择器。
实例：


### 6、打开全民商探页面
简述：点击被选择的元素，web页面跳转触屏版全民商探web页面，App则跳转全民商探的App原生页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被操点击的Dom的元素上添加class="open-star-powder"激活调用跳转全民商探接口的函数。
	实例：

	Js模式
	在被操作的Dom元素上添加选择器，以此作为调用openStarPowder()的Dom节点。
openStarPowder(selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可class、id、标签等选择器。
url
string
'http://m.soolife.cn/business.html'
web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。
实例：



### 7、打开钱包充值页面
简述：点击被选择的元素，web页面提示用户：’请在“如此生活”中打开’，App则打开钱包支付页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-pay-purse"激活打开钱包支付页面接口的函数。
	实例：

	Js模式
	在被操作的Dom元素上添加选择器，以此作为调用openPayPurse()的Dom节点。
openPayPurse(selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
需操作的Dom节点，可c lass、id、标签选择器。
url
string
null
web跳转的链接地址，可有可无；没有则跳转默认地址，默认地址为null，web页面提示用户“请在‘如此生活’打开”，App则正常跳转；有则跳转传入的地址。
实例：



### 8、打开星粉联页面
简述：点击被选择的元素，web页面跳转触屏版星粉联页面，App则打开星粉联App原生页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-ingitation"激活打开星粉联页面接口的函数。
	实例：


Js模式
	在被点击的Dom元素上添加选择器，以此作为调用openIngitation()的Dom节点。
openIngitation(selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可用class、id、标签等选择器。
url
string
'http://m.soolife.cn/starfans.html'
web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。
实例：



### 9、打开海外购页面
简述：点击被选择的元素，web页面打开触屏版海外购页面，App则打开海外购原生App页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被操作的Dom的元素上添加class="open-overseas-buy"激活打开海外购页面接口的函数。
	实例：

	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用openOverseasBuy()的Dom节点。
openOverseasBuy(selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可用class、id、标签等选择器。
url
string
http://m.soolife.cn/seagood.html
web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。


实例：



### 10、打开领星币页面
简述：点击被选择的元素，web页面跳转触屏版领星币页面，App则打开领星币App原生页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-luxury-life"激活打开领星币页面接口的函数。
	实例：

	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用openLuxuryLife()的Dom节点。
openLuxuryLife(selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可class、id、标签等选择器。
url
string
'http://m.soolife.cn/life.html'
web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。
实例：



### 11、打开会员星粉秀列表页面
简述：点击被选择的元素，web页面打开触屏版会员星粉秀列表web页面，App则打开会员星粉秀列表的App原生页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-my-fans-show"激活打开星粉秀列表页面接口的函数。
	实例：

	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用openMyFansShow()的Dom节点。
openMyFansShow(selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可class、id、标签等选择器。
url
string
'https://i.soolife.cn/m/exist/mystarshow.html'
web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。
实例：



### 12、打开会员优惠券列表页面
简述：点击被选择的页面元素，web页面打开触屏版会员优惠券列表web页面，App则打开优惠券列表App原生页面。

实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-my-coupon"激活打开会员优惠券列表页面接口的函数。
	实例：

	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用openMyCoupon()的Dom节点。
openMyCoupon(selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可class、id、标签选择器。
url
string
'https://i.soolife.cn/m/exist/mycoupons.html'
web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。
实例：



### 13、打开我的收入页面
简述：点击被选择的元素，web页面打开触屏版我的收入web页面，App则打开我的收入App原生页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-my-income"激活打开我的收入页面接口的函数。
	实例：

	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用openMyIncome()的Dom节点。
openMyIncome(selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可class、id、标签选择器。
url
string
'https://i.soolife.cn/m/exist/income.html'
web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。
实例：



### 14、打开邀请记录页面
简述：点击被选择的元素，web页面打开触屏版邀请记录的web页面，App则打开邀请记录App原生页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-my-invited-record"激活打开邀请记录页面接口的函数。
	实例：

	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用openMyInvitedRecord()的Dom节点。
openMyInvitedRecord(selector,[url])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可class、id、标签等选择器。
url
string
'https://i.soolife.cn/m/exist/questrecord.html'
web跳转的链接地址，可有可无；没有则跳转默认地址，有则跳转传入的地址。

实例：



### 15、跳转立即购买页面
简述：点击被选择的元素，web页面打开该商品的商品详情页面，App则打开对应商品的立即购买App原生页面。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="open-instant-buy"激活打开立即购买接口的函数，将该商品的商品编号携带在data-goods-id=" " 属性上。
实例：

此时系统会默认购买方式为单品购买，购买该商品1件，如果需要改变购买方式、定量或是动态传入一定量的购买量，则需要自定义一段js进行传参，建议将该js编写在另一个js文件中，并在加载sdk.2.0.js文件之后加载该js文件。具体传参过程如下：

即可改变购买方式、购买数量。
	Js模式
	在被操作的Dom元素上添加选择器，以此作为调用openInstantBuy()的Dom节点。
openInstantBuy(selector,goodsId,[objPara])的参数介绍：




参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可用class、id、标签等选择器。
goodsId
string/number
无
购买的商品的商品编号。
objPara
object
{
buyType: 1,
buyNumber: 1,
href:'https://orders.soolife.cn/m/order/index.html?skuid='+id+'&qty='+buyN+'&type='+buyT+'&order_type=true';
}
objPara为json型参数，可选择传入，没有传入，则为默认值；{ }里面的值均选择可传入，不分传入顺序，不传值则设置为默认值。
buyType为购买方式：1代表单品购买方式，2代表套餐购买方式；
buyNumber为购买的数量，默认值为1；href为web跳转地址。
实例：

### 16、加入购物车
简述：点击被选择的元素，web页面跳转触屏版购物车页面，App则将该商品添加至购物车并返回添加成功或是失败的提示信息。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="add-carts"激活跳转购物车页面接口的函数，将该商品的商品编号携带在data-goods-id=" " 属性上。
实例：

此时系统会默认添加商品量为1件，如果需要定量或是动态传入一定量的添加量，则需要自定义一段js进行传参，建议将该js编写在另一个js文件，并在加载sdk.2.0.js文件之后加载该js文件。具体传参如下：


即可添加传入数量的商品至购物车。
	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用addCarts()的Dom节点。
addCarts(selector,goodsId,[objPara])的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可用class、id、标签等选择器。
goodsId
string/number
无
需添加到购物车的商品的商品编号。
objPara
object
{
addNumber: 1,
href:'http://item.soolife.cn/m/'+ goodsId +'.html'
}
objPara为json参数，可选择传入，没有传入，则为默认值；{ }里面的值均选择可传入，不分传入顺序，不传值统统设置为默认值。addNumber为添加的数量，默认值为1；
href为web跳转地址。
实例：



### 17、回到首页
简述：点击被选择的元素，web页面跳转触屏版首页，App则将跳转App的原生首页。
实现方法：
	Data属性模式
	不需写 Js 代码。在被点击的Dom的元素上添加class="back-home"激活回到首页接口的函数。
实例：

	Js模式
	在被点击的Dom元素上添加选择器，以此作为调用backHome()的Dom节点。
backHome (selector)的参数介绍：
参数
类型
默认值
描述
selector
string
无
被点击的Dom节点，可用class、id、标签等选择器。
实例：

### 18、当前页分享
简述：App则获得当前页面提供的分享参数并分享出去，触屏版的相应功能正在开发。分享当前页的功能和其他交互功能不一样，Web和App分开实现。
App实现方法：
App中的分享按钮使用原生按钮，和Dom节点没有关系，需要web页面在App的内部浏览器加载完成的时候就暴露相应的参数。不需页面中的Dom节点。
不需要多余的Js操作，需要将分享的内容，以参数的形式传入:
webSdk.currentSharePara = objPara ;
传入的参数介绍：
参数
类型
默认值
描述
objPara
object
无
objPara为json参数， { }里面的值不分传入顺序
shareImg为分享的图片，大小<20KB；
shareTitle为分享的主标题；
shareDTitle为分享的副标题。






实例：

Web页面的实现方法：

功能正在开发中…

## 三、web打开App的悬浮按钮
页面效果：（下图中的红框部分）

功能效果：
当页面加载sdk.2.0.js文件时，并且在App的外部浏览器中打开，则该按钮就会出现，并定位在可视区域的中下部；可点击‘×’按钮消失，点击按钮则会打开App，且App的页面与该web页面相对应；如果用户没有下载App则跳转相应的下载页面（如：web页面是商品详情页，则点击按钮跳转到App的商品详情页）。
当页面加载sdk.2.0.js文件时，在App的内部浏览器中按钮就不会出现，自然没有所有的点击效果。
实现方法：
	只需加载sdk.2.0.js文件，添加好交互页面的信息对应（下面会介绍）就可以实现上述的页面效果和功能效果。
交互页面的信息对应：
需要帮助sdk.2.0.js判断该按钮出现在当前的web页面是什么页面，从而做到点击按钮时跳转到相应的App页面，具体如下：
    打开sdk.2.0.js文件找到数组portKeyDoor，将需要该交互功能的消息添加到porKeyDoor中。
添加的信息介绍：
	一个交互页面对应数组的中的一个{ }元素，上图是已完成并成功跳转的信息对应实例。
htmlName是该页面的简称，方便控制台调试，可以不添加；
testHref是该Web页面的链接地址中的固定部分，并写成正则判断形式；
portKey  是App提供跳转的接口参数（需要App开发人员提供）；
portSku  是从Web页面的链接地址中获得的商品、店铺等对应编号信息，这里已经做好处理，
如图Web页面存在编号信息则写portSku:sku；Web页面不存在编号信息，只是单纯的链接地址则写portSku:""。

## 四、正在开发中的功能

| 函数     | 功能     |
| :------------- | :------------- |
| currentShare      | 当前页分享的web页面操作       |
| openShare      |  分享      |
| openIssueFansShow      | 发布星粉秀       |
| rockGet      | 订阅摇一摇       |
| rockOut      | 取消订阅摇一摇       |
| getIbeacon      | 获取周围ibeacon设备       |
| getPlace      | 得到经纬度       |
